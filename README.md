# atom-chat API

## Описание

Задание: https://github.com/notafavor/test-cases/blob/main/case_2.md  
Проект написан на Django REST Framework  
Это API атом чата, в котором пользователи могут общаться в приватных каналах. В проекте есть система регистрации и авторизации по JWT токену, роль модератора, 
функционал просмотра истории собщений, а все сообщения отправляются в режиме "реального времени" с помошью WebSocket.  

## Предварительные требования

Перед запуском проекта убедитесь, что у вас установлены:

- Docker Desktop
- Python, версия не ниже 3.10

## Установка и запуск

Для запуска проекта выполните следующие шаги:

1. Клонируйте репозиторий на ваше устройство:
   ```
   git clone https://github.com/AleksandrSafarov/atom-chat
   ```
2. Перейдите в директорию проекта:
   ```
   cd atom-chat
   ```
3. Создайте виртуальное окружение:
   ```
   python -m venv venv
   ```
4. Активируйте виртуальное окружение:
   ```
   venv\Scripts\activate
   ```
5. Соберите и запустите проект с помощью Docker Compose:
   ```
   docker-compose up --build
   ```

После успешного выполнения это команды проект будет доступен по указанным URL.

## Доступные URL-адреса проекта

Ниже представлен список всех доступных URL-адресов с описанием их назначения.

### HTTP URL-адреса

- **Регистрация пользователя**  
  **Метод:** `POST`  
  **URL:** `http://127.0.0.1:8000/register/`  
  Обрабатывается представлением `RegisterView`. Позволяет зарегистрировать нового пользователя.  
  В теле запроса укажите поля `username` (имя пользователя), `password` и `password2`(пароль и повторный ввод пароля).

- **Вход в систему (получение JWT токена)**  
  **Метод:** `POST`  
  **URL:** `http://127.0.0.1:8000/login/`  
  Обрабатывается представлением `TokenObtainPairView`. Возвращает пару токенов (доступа и обновления).  
  В теле запроса укажите поля `username` и `password` для пользователя, который уже зарегистрирован в системе.  

- **Обновление JWT токена доступа**  
  **Метод:** `POST`  
  **URL:** `http://127.0.0.1:8000/token/refresh/`  
  Обрабатывается представлением `TokenRefreshView`. Позволяет обновить токен доступа.  
  В теле запроса укажите поле `refresh` со значением токена обновления.

- **Получение информации о пользователе**  
  **Метод:** `GET`  
  **URL:** `http://127.0.0.1:8000/user/<user_id>/`  
  Обрабатывается представлением `UserView`. Возвращает информацию о пользователе по его ID.  
  Нужно указать токен доступа с типом авторизационного токена: Bearer Token.

- **Блокировка пользователя**  
  **Метод:** `POST`  
  **URL:** `http://127.0.0.1:8000/block-user/<user_id>/`  
  Обрабатывается представлением `BlockUserView`. Блокирует пользователя по его ID.  
  Доступно только модераторам.  
  Нужно указать токен доступа с типом авторизационного токена: Bearer Token.

- **Предоставление прав модератора пользователю**  
  **Метод:** `POST`  
  **URL:** `http://127.0.0.1:8000/promote-to-moderator/<user_id>/`  
  Обрабатывается представлением `PromoteToModeratorView`. Назначает пользователя модератором по его ID.  
  Доступно только модераторам.  
  Нужно указать токен доступа с типом авторизационного токена: Bearer Token.

- **Создание нового канала**  
  **Метод:** `POST`  
  **URL:** `http://127.0.0.1:8000/c/create/`  
  Обрабатывается представлением `ChannelCreateView`. Создаёт новый канал.  
  В теле запроса укажите поля `name` (имя канала) и `password` (пароль для получения доступа к каналу). Опционально можно добавить поле `participants` с перечислением ID пользователей, которых можно сделать сразу участниками канала.  
  Нужно указать токен доступа с типом авторизационного токена: Bearer Token.

- **Проверка пароля для канала**  
  **Метод:** `POST`  
  **URL:** `http://127.0.0.1:8000/c/<channel_id>/check-password/`  
  Обрабатывается представлением `ChannelPasswordCheckView`. Проверяет пароль для доступа к каналу.  
  В теле запроса укажите поля `password` с паролем для канала.  
  Нужно указать токен доступа с типом авторизационного токена: Bearer Token.

- **Создание сообщения в канале**  
  **Метод:** `POST`  
  **URL:** `http://127.0.0.1:8000/c/<channel_id>/create-message/`  
  Обрабатывается представлением `MessageCreateView`. Создаёт сообщение в указанном канале.
  В теле запроса укажите поля `text` с текстом сообщения.   
  Пользователь должен быть участником канала или модератором.  
  Нужно указать токен доступа с типом авторизационного токена: Bearer Token.
  Нужен для проверки работоспособности создания сообщения.

- **Получение списка сообщений канала**  
  **Метод:** `GET`  
  **URL:** `http://127.0.0.1:8000/c/<channel_id>/messages/`  
  Обрабатывается представлением `MessageListView`. Возвращает все сообщения для указанного канала.  
  Пользователь должен быть участником канала или модератором.  
  Нужно указать токен доступа с типом авторизационного токена: Bearer Token.

### WebSocket URL-адрес

- **Подключение к WebSocket канала**  
  `ws://127.0.0.1:8000/ws/channel/<channel_id>/`  
  Обрабатывается потребителем `ChannelConsumer`. Устанавливает WebSocket соединение для указанного канала.  
  Пользователь должен быть участником канала или модератором.  
  Нужно в заголовке запроса добавить поле `Authorization` со значением `"Bearer " + значение токена доступа`.  
  Сообщение отправляется в виде:
  ```
   {
    "message": "Your message"
   }
  ```


## Дополнительная информация
- Проект запускается с помощью docker-compose
- Если сборка проекта происходит впервые, база данных заполняется тестовыми данными с помощью скрипта
- Тестовые данные можно проверить в админ странице Django. Для этого:
  - Запустите проект по инструкции выше
  - Перейдите по URL `http://127.0.0.1:8000/admin/`
  - Введите:
    - Имя пользователя: `admin`
    - Пароль: `qwerty_wasd`
  - После этого вы сможете просмотреть данные о созданных тестовых пользователях, каналах и сообщениях
